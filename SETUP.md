# U.A.C.C (Unified AI Communication Companion) – Project Setup Guide

> This guide walks you through preparing a development environment, configuring backend services, running the Flutter app, deploying Firebase Functions, and adopting recommended workflows.

<!-- Added: Quick Links -->
**Quick Links:** [Ignore Rules](#18-gitignore--repository-hygiene) · [Python Tooling](#19-optional-python-tooling) · [Secrets Handling](#20-secrets--credential-handling)

---
## 1. Project Overview
- **Client:** Flutter (Android primary target; iOS scaffolding present)
- **Backend:** Firebase (Auth, Firestore, Storage, Messaging, Crashlytics, Analytics)
- **Serverless Add‑on:** Cloud Function (`geminiProxy`) – Node.js 18 (Gemini model invocation)
- **Supplemental:** Local Android native code (widgets, dynamic island style overlay services), notification + call state handling.
- **Assets:** Lottie animations, icons, images, sounds, custom fonts

## [IMP] hardcode the api keys in #NotificationSummaryService.kt line 35 and #ai_analysis_service.dart line 6.

```
Root
├── lib/                   # Flutter app source
├── android/               # Android native layer & build config
├── ios/                   # iOS scaffolding
├── functions/             # Firebase Cloud Function (Node.js 18)
├── assets/                # Animations, fonts, images, sounds
├── firebase.json          # Firebase project + functions runtime
├── pubspec.yaml           # Flutter dependencies & assets
├── google-services.json   # Android Firebase config (DO NOT COMMIT different envs)
├── GoogleService-Info.plist # iOS Firebase config
├── firebase_options.dart  # Generated by FlutterFire CLI
└── SETUP.md               # This setup guide
```

---
## 2. Prerequisites
| Category | Requirement |
|----------|-------------|
| OS       | Windows/macOS/Linux (Android focus; Windows already fine) |
| Flutter  | SDK ^3.6.x (match `environment.sdk` in `pubspec.yaml`) |
| Android  | Android Studio + SDK Platform 35 (or 34) + emulator or physical device |
| Java     | JDK 17+ (AGP 8.x compatible) |
| Node.js  | v18.x (Functions) |
| Firebase | Firebase CLI (`npm i -g firebase-tools`) |
| Git      | Version control |
| Optional | Python (only if you use optional experimentation scripts) |

### Verify Installations
```powershell
flutter --version
node -v
firebase --version
java -version
```

---
## 3. Clone & Bootstrap
```powershell
git clone <your-fork-or-origin-url> uacc
cd uacc
flutter pub get
```
If `pub get` fails because of SDK mismatch, install the matching Flutter channel or update `environment.sdk` cautiously.

---
## 4. Firebase Configuration
### 4.1 Login & Project Selection
```powershell
firebase login
firebase use --add   # select or type the project: uacc-uacc
```
The `firebase.json` already declares the project IDs inside the Flutter section, but build‑time config uses:
- Android App ID: `1:295187812275:android:6133513670ab9f697445c6`
- iOS App ID: `1:295187812275:ios:1d63675c89bbdb017445c6`
- Web App ID: `1:295187812275:web:26b1f23f855fbae57445c6`

### 4.2 Generate `firebase_options.dart` (if missing/outdated)
```powershell
flutterfire configure --project=uacc-uacc
```
This regenerates `lib/firebase_options.dart` and wires multi-platform configs.

### 4.3 Place Credential Files
Ensure these exist (never mix staging vs production inadvertently):
- `android/app/google-services.json`
- `ios/Runner/GoogleService-Info.plist`

### 4.4 Enable Firebase Services
In Firebase console enable: Auth (Email/Google), Firestore, Cloud Messaging, Storage, Analytics, Crashlytics. Run Crashlytics once in a debug build to finalize linkage.

### 4.5 Firestore Security (High-Level)
Define granular rules (pseudo):
```js
match /users/{uid} {
  allow read, write: if request.auth != null && request.auth.uid == uid;
}
```
(Adjust to support shared task boards or notification digests.)

---
## 5. Flutter App – Run & Build
### 5.1 Run on Device / Emulator
```powershell
flutter doctor
flutter pub get
flutter run --debug
```
If build fails with compileSdk warning (e.g. 36 unsupported), add to `android/gradle.properties`:
```
android.suppressUnsupportedCompileSdk=36
```
Or lower to a supported compileSdk (currently 35) in `android/app/build.gradle`.

### 5.2 Common Run Issues
| Symptom | Fix |
|---------|-----|
| `Failed to compile Kotlin` | Ensure JDK 17, invalidate Gradle caches (`gradlew clean`) |
| Firebase plugin missing | Run `flutterfire configure` again |
| `google-services.json` missing | Re-download from console |
| AndroidX version mismatch | `flutter clean` then rerun |

### 5.3 Release (Android)
```powershell
flutter build apk --release
```
Configure signing in `android/app/build.gradle` if not already done.

> **Offline / firewalled builds:** Crashlytics uploads a mapping file during release builds. If you're offline (UnknownHost for `firebasecrashlyticssymbols.googleapis.com`), set an environment variable before running Flutter:
> ```powershell
> $env:SKIP_CRASHLYTICS_UPLOAD = 'true'
> flutter run --release
> ```
> Or pass a Gradle property: `flutter build apk --release -PskipCrashlyticsUpload`. Remove the env var / property to restore uploads when you're back online (e.g., CI).

---
## 6. Firebase Cloud Functions
### 6.1 Install Dependencies
```powershell
cd functions
npm install
```

### 6.2 Local Emulation
```powershell
firebase emulators:start --only functions
```

### 6.3 Deploy
```powershell
firebase deploy --only functions:geminiProxy
```
Environment secret for Gemini is stored in Secret Manager (function uses `@google-cloud/secret-manager`). Example to add a secret:
```powershell
gcloud secrets create GEMINI_API_KEY --data-file=key.txt
```
Grant the Functions service account access:
```powershell
gcloud secrets add-iam-policy-binding GEMINI_API_KEY \
  --member=serviceAccount:YOUR_FUNCTION_SA \
  --role=roles/secretmanager.secretAccessor
```
No Gemini key is ever bundled into the Flutter binary—calls route through the authenticated proxy.

---
## 7. Project Structure Highlights
| Area | Notes |
|------|-------|
| `lib/` | Flutter UI, state (Provider & Riverpod), services (Firebase, speech, notifications) |
| `android/app/src/main/kotlin/.../widgets` | Custom Glance AppWidgets (e.g. CookieCalendarWidget, TasksWidget) |
| Dynamic island services | Custom overlay / notification enrichment (check `DynamicIsland*` classes) |
| Cloud Function | Gemini proxy for LLM summarization / augmentation |
| Assets | Animations (Lottie), fonts, svg icons, sounds |

---
## 8. Styling & Theming
- AMOLED adaptation done in widgets (dark-first design)
- Ensure system overlays & status bar icons are visible on pure black backgrounds
- For new widgets follow grayscale + accent minimalism to preserve battery on OLED panels

---
## 9. Linting & Code Quality
Run analyzer:
```powershell
flutter analyze
```
Run tests:
```powershell
flutter test
```
Use `build_runner` for json serialization (if annotated models added):
```powershell
flutter pub run build_runner build --delete-conflicting-outputs
```

---
## 10. Adding New Firebase Services
1. Enable in console
2. Add dependency in `pubspec.yaml`
3. `flutter pub get`
4. Update initialization (usually `main.dart` after `Firebase.initializeApp`)
5. Adjust security rules & test

---
## 11. Environment / Secrets Strategy
| Secret | Location | Recommendation |
|--------|----------|----------------|
| GEMINI_API_KEY | Secret Manager | Never store in repo; accessed server-side only |
| Service Account JSON | Local dev only (`.gitignore`) | Use env var path |
| Encryption keys | OS keystore / secure storage | Keep per-user |

---
## 12. Automation & CI (Suggested)
- GitHub Actions for: lint + test + build APK artifact
- Optional: Deploy Functions on merge to `main`
- Cache: Pub / Gradle wrappers

Sample matrix (conceptual):
```yaml
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.6.x'
      - run: flutter pub get
      - run: flutter analyze
      - run: flutter test
      - run: flutter build apk --debug
```

---
## 13. Troubleshooting Matrix
| Problem | Likely Cause | Resolution |
|---------|--------------|-----------|
| Crash at startup (Firebase) | Missing config files | Re-run FlutterFire configure |
| Cloud Function 403 | Missing IAM on secret | Adjust Secret Manager IAM |
| Slow Gradle sync | Old daemon / caches | `gradlew --stop && gradlew clean` |
| High battery drain | Unoptimized overlays / listeners | Debounce listeners, review services |

---
## 14. Contributing
1. Create a feature branch
2. Keep commits atomic
3. Run analyze & test before PR
4. Provide screenshots for UI changes
5. Reference issues in PR description

---
## 15. Roadmap (Suggested)
- Add offline transcript summarization toggle
- Integrate on-device embedding index for semantic recall
- Add notification priority ML fine-tuning pipeline
- Introduce accessibility voice commands layer

---
## 16. License / Attribution
Internal Samsung PRISM research asset (verify distribution rules). Third‑party licenses apply for dependencies.

---
## 17. Support
For build issues: open GitHub Issue with logs.
For security concerns: use private channel / security contact.

---
## 18. .gitignore & Repository Hygiene
A unified `.gitignore` is provided covering:
- Flutter / Dart build artifacts (`.dart_tool/`, `build/`)
- Android + iOS intermediates (`android/**/intermediates/`, `ios/DerivedData/`)
- Node Cloud Functions (`functions/node_modules/`)
- Secret & credential patterns (service accounts, keystores, `google-services.json` unless intentionally versioned)

If you intentionally need to version an env-specific JSON (rare), place it in a dedicated `env/` folder and document why in its own `README`. Avoid committing raw service account keys—use Application Default Credentials or Secret Manager.

### Pre-Commit Hardening (Optional)
Add a `.git/hooks/pre-commit` script:
```bash
#!/usr/bin/env bash
if git diff --cached --name-only | grep -Ei '(serviceAccount|firebase-adminsdk|uacc-uacc-).*\.json$'; then
  echo 'ERROR: Service account JSON staged. Remove before commit.'
  exit 1
fi
```

---
## 19. Optional Python Tooling
The core stack does not require Python. A curated `requirements.txt` lists optional groups (LLM experiments, data analysis, secret scanning). To activate:
```powershell
python -m venv .venv
. .venv/Scripts/Activate.ps1
pip install -r requirements.txt
```
Uncomment only the packages you need to keep supply chain surface minimal.

---
## 20. Secrets & Credential Handling
| Artifact | Store In | Notes |
|----------|----------|-------|
| Firebase Admin auth (Functions) | Built-in ADC | No JSON key needed inside Cloud Functions runtime |
| Service account keys (local dev) | Local disk (ignored) | Revoke immediately if committed |
| GEMINI_API_KEY | Secret Manager / Functions config | Never ship to Flutter client |
| `google-services.json` / `GoogleService-Info.plist` | Platform folders | Treat staging vs prod separately |
| Encryption keys | OS keystore / secure storage | Do not check in |

**Incident Response:** If a private key is exposed, delete the key in IAM → purge from git history → rotate secrets → audit logs.

---
*End of Setup Guide*
